service: MBS

package:
  exclude:
    - node_modules/**/README.*
    - node_modules/**/test/**
    - node_modules/**/aws-sdk/**

provider:
  name: aws
  runtime: nodejs12.x
  timeout: 60
  region: ap-southeast-1
  stage: ${opt:stage, 'dev'}

  environment:
    RDS_DB_HOST: omrs-qa-uat.cluster-cuiylgqybm2l.ap-southeast-1.rds.amazonaws.com
    RDS_DB_HOST_READ: omrs-rds-proxy-read-only.endpoint.proxy-cuiylgqybm2l.ap-southeast-1.rds.amazonaws.com
    RDS_DB_NAME: mbs_dev
    RDS_DB_USER: omrs-prxyrds-user
    RDS_DB_PASSWORD: EHh9cCydvqyN3v3Jj3ATqfD8nLVrn8DJVwh4tUVwz
    DATABASE_API_URL: https://v8unrf4edd.execute-api.ap-southeast-1.amazonaws.com/staging

    #IDMS
    IDMS_URL: https://yw7yyq22k8.execute-api.ap-southeast-1.amazonaws.com/dev
    IDMS_APP_KEY: 3

plugins:
  - serverless-offline

custom:
  allowed-headers:
    - Content-Type
    - X-Amz-Date
    - Authorization
    - X-Api-Key
    - X-Amz-Security-Token
    - X-Amz-User-Agent
    - X-App-Key

functions:
  ADMIN-ACCOUNTS:
    handler: src/handlers/accounts.handler
    events:
      - http:
          path: /admin/accounts
          method: ANY
          cors:
            origin: "*"
            headers: ${self:custom.allowed-headers}
            allowCredentials: true
      - http:
          path: /admin/accounts/{proxy+}
          method: ANY
          cors:
            origin: "*"
            headers: ${self:custom.allowed-headers}
            allowCredentials: true
  MBS-WEBHOOKS:
    handler: src/handlers/app/webhooks.handler
    events:
      - http:
          path: /app
          method: ANY
          cors:
            origin: "*"
            headers: ${self:custom.allowed-headers}
            allowCredentials: true
      - http:
          path: /app/{proxy+}
          method: ANY
          cors:
            origin: "*"
            headers: ${self:custom.allowed-headers}
            allowCredentials: true
 